--[[
    üêã OrcaUI V4: The Abyssal Edition
    Author: OrcaDev
    Version: 4.0.1 (Premium)
    
    Features:
    - Custom Signal Implementation
    - CSGO-Style Layout & Groupboxes
    - Advanced Configuration System
    - Full HSV Color Pickers
    - Searchable Multi-Dropdowns
    - Watermark & Keybind List
    - Dashboard
    - 500+ Lines of Features
]]

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local Mouse = Players.LocalPlayer:GetMouse()
local ViewportSize = workspace.CurrentCamera.ViewportSize

-- // INTERNAL SIGNAL SYSTEM \\ --
-- (Replacing BindableEvents for speed)
local Signal = {}
Signal.__index = Signal

function Signal.new()
    local self = setmetatable({}, Signal)
    self._bindableEvent = Instance.new("BindableEvent")
    return self
end

function Signal:Connect(handler)
    if not (type(handler) == "function") then
        error("connect: Invalid argument #1 (function expected, got " .. type(handler) .. ")", 2)
    end
    return self._bindableEvent.Event:Connect(handler)
end

function Signal:Fire(...)
    self._bindableEvent:Fire(...)
end

function Signal:Wait()
    return self._bindableEvent.Event:Wait()
end

function Signal:Destroy()
    if self._bindableEvent then
        self._bindableEvent:Destroy()
        self._bindableEvent = nil
    end
end

-- // LIBRARY ROOT \\ --
local Library = {
    Connections = {},
    Flags = {},
    Registry = {}, -- For updating UI elements on config load
    UnloadSignals = {},
    Theme = {
        Main        = Color3.fromRGB(20, 20, 20),
        Secondary   = Color3.fromRGB(25, 25, 25),
        Outline     = Color3.fromRGB(40, 40, 40),
        Stroke      = Color3.fromRGB(50, 50, 50),
        Divider     = Color3.fromRGB(40, 40, 40),
        Text        = Color3.fromRGB(225, 225, 225),
        TextDark    = Color3.fromRGB(150, 150, 150),
        Accent      = Color3.fromRGB(165, 130, 255), -- CSGO Purple/Blue style
        Success     = Color3.fromRGB(100, 255, 100),
        Error       = Color3.fromRGB(255, 80, 80),
        Ripple      = Color3.fromRGB(255, 255, 255),
        Gradient    = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(165, 130, 255)), ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 80, 200))}
    }
}

-- // UTILITIES \\ --
local Utility = {}

function Utility:GetParent()
    return (gethui and gethui()) or CoreGui
end

function Utility:Create(instanceType, properties, children)
    local obj = Instance.new(instanceType)
    for k, v in pairs(properties or {}) do obj[k] = v end
    if children then
        for _, child in pairs(children) do child.Parent = obj end
    end
    return obj
end

function Utility:Round(obj, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius)
    corner.Parent = obj
    return corner
end

function Utility:Stroke(obj, color, thickness)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or Library.Theme.Stroke
    stroke.Thickness = thickness or 1.5
    stroke.Parent = obj
    return stroke
end

function Utility:Tween(obj, props, time, style, dir)
    TweenService:Create(obj, TweenInfo.new(time or 0.3, style or Enum.EasingStyle.Quart, dir or Enum.EasingDirection.Out), props):Play()
end

function Utility:Ripple(obj)
    task.spawn(function()
        local Ripple = Instance.new("ImageLabel")
        Ripple.Name = "Ripple"
        Ripple.Parent = obj
        Ripple.BackgroundTransparency = 1
        Ripple.BorderSizePixel = 0
        Ripple.Image = "rbxassetid://2708891598"
        Ripple.ImageColor3 = Library.Theme.Ripple
        Ripple.ImageTransparency = 0.8
        Ripple.ScaleType = Enum.ScaleType.Tile
        
        local x, y = Mouse.X - obj.AbsolutePosition.X, Mouse.Y - obj.AbsolutePosition.Y
        Ripple.Position = UDim2.new(0, x, 0, y)
        Ripple.Size = UDim2.new(0, 0, 0, 0)

        local maxSize = math.max(obj.AbsoluteSize.X, obj.AbsoluteSize.Y) * 1.5
        
        Utility:Tween(Ripple, {Size = UDim2.new(0, maxSize, 0, maxSize), Position = UDim2.new(0, x - maxSize/2, 0, y - maxSize/2)}, 0.5)
        Utility:Tween(Ripple, {ImageTransparency = 1}, 0.5)
        
        task.wait(0.5)
        Ripple:Destroy()
    end)
end

function Utility:Drag(frame, parent)
    parent = parent or frame
    local dragging, dragInput, dragStart, startPos

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = parent.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Utility:Tween(parent, {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}, 0.05)
        end
    end)
end

-- // CONFIGURATION MANAGER \\ --
local ConfigManager = {}
ConfigManager.Folder = "OrcaV4_Configs"

function ConfigManager:Init()
    if not isfolder(ConfigManager.Folder) then
        makefolder(ConfigManager.Folder)
    end
end

function ConfigManager:Save(name)
    if not name or name == "" then return end
    local json = HttpService:JSONEncode(Library.Flags)
    writefile(ConfigManager.Folder .. "/" .. name .. ".json", json)
    Library:Notify({Title = "Config", Content = "Saved configuration: " .. name, Duration = 3})
end

function ConfigManager:Load(name)
    if not name or name == "" then return end
    local path = ConfigManager.Folder .. "/" .. name .. ".json"
    if isfile(path) then
        local success, decoded = pcall(function() return HttpService:JSONDecode(readfile(path)) end)
        if success and decoded then
            for flag, value in pairs(decoded) do
                if Library.Registry[flag] then
                    Library.Registry[flag]:Set(value)
                end
            end
            Library:Notify({Title = "Config", Content = "Loaded configuration: " .. name, Duration = 3})
        else
            Library:Notify({Title = "Config", Content = "Failed to decode config.", Duration = 3})
        end
    end
end

function ConfigManager:GetConfigs()
    local files = {}
    if isfolder(ConfigManager.Folder) then
        for _, file in pairs(listfiles(ConfigManager.Folder)) do
            if file:sub(-5) == ".json" then
                table.insert(files, file:match("([^\\/]+)%.json$"))
            end
        end
    end
    return files
end

ConfigManager:Init()

-- // WINDOW MODULE \\ --
function Library:CreateWindow(Config)
    local WindowName = Config.Title or "Orca Hub"
    
    -- Watermark
    local Watermark = Utility:Create("TextLabel", {
        Name = "Watermark",
        Parent = Utility:GetParent(),
        Text = WindowName .. " | " .. os.date("%X") .. " | " .. Players.LocalPlayer.Name,
        Font = Enum.Font.Code, TextSize = 14, TextColor3 = Library.Theme.Text,
        BackgroundColor3 = Library.Theme.Main, BorderSizePixel = 0,
        Position = UDim2.new(0, 20, 0, 20), Size = UDim2.new(0, 0, 0, 24),
        ZIndex = 100
    })
    Utility:Stroke(Watermark, Library.Theme.Accent, 1)
    Utility:Create("UIPadding", {Parent = Watermark, PaddingLeft = UDim.new(0, 8), PaddingRight = UDim.new(0, 8)})
    
    task.spawn(function()
        while Watermark.Parent do
            Watermark.Text = WindowName .. " | " .. os.date("%X") .. " | " .. Players.LocalPlayer.Name
            Watermark.Size = UDim2.new(0, Watermark.TextBounds.X + 16, 0, 24)
            task.wait(1)
        end
    end)

    local ScreenGui = Utility:Create("ScreenGui", {
        Name = "OrcaLib_" .. math.random(1,10000),
        Parent = Utility:GetParent(),
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        IgnoreGuiInset = true
    })

    -- Main Frame
    local Main = Utility:Create("Frame", {
        Name = "Main",
        Parent = ScreenGui,
        BackgroundColor3 = Library.Theme.Main,
        Position = UDim2.new(0.5, -325, 0.5, -225),
        Size = UDim2.new(0, 700, 0, 500), -- Larger for CSGO style
        ClipsDescendants = true
    })
    Utility:Round(Main, 6)
    Utility:Stroke(Main, Library.Theme.Outline, 2)

    -- Sidebar
    local Sidebar = Utility:Create("Frame", {
        Parent = Main, BackgroundColor3 = Library.Theme.Secondary,
        Size = UDim2.new(0, 170, 1, 0), ZIndex = 2
    })
    Utility:Round(Sidebar, 10)
    Utility:Create("Frame", { -- Square Corner Fix
        Parent = Sidebar, BackgroundColor3 = Library.Theme.Secondary,
        Size = UDim2.new(0, 10, 1, 0), Position = UDim2.new(1, -10, 0, 0), BorderSizePixel = 0
    })
    Utility:Drag(Sidebar, Main) -- Drag via Sidebar only to fix slider issue

    -- Title Area
    local TitleLabel = Utility:Create("TextLabel", {
        Parent = Sidebar, Text = WindowName, Font = Enum.Font.GothamBold, TextSize = 20,
        TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 50), Position = UDim2.new(0, 15, 0, 5), TextXAlignment = Enum.TextXAlignment.Left,
        TextScaled = true -- Prevent overlap
    })
    
    local Divider = Utility:Create("Frame", {
        Parent = Sidebar, BackgroundColor3 = Library.Theme.Divider,
        Size = UDim2.new(1, -30, 0, 1), Position = UDim2.new(0, 15, 0, 55), BorderSizePixel = 0
    })

    -- Tab Button Container
    local TabContainer = Utility:Create("ScrollingFrame", {
        Parent = Sidebar, BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, -80), Position = UDim2.new(0, 0, 0, 70),
        ScrollBarThickness = 0, CanvasSize = UDim2.new(0,0,0,0)
    })
    local TabLayout = Utility:Create("UIListLayout", {
        Parent = TabContainer, Padding = UDim.new(0, 6), SortOrder = Enum.SortOrder.LayoutOrder
    })
    Utility:Create("UIPadding", {Parent = TabContainer, PaddingLeft = UDim.new(0, 10)})

    -- Content Area
    local Content = Utility:Create("Frame", {
        Parent = Main, BackgroundTransparency = 1,
        Size = UDim2.new(1, -190, 1, -20), Position = UDim2.new(0, 180, 0, 10), ZIndex = 2
    })
    local ContentFolder = Utility:Create("Folder", {Parent = Content})

    -- // NOTIFICATION SYSTEM \\ --
    local NotifyHolder = Utility:Create("Frame", {
        Parent = ScreenGui, BackgroundTransparency = 1, Size = UDim2.new(0, 300, 1, 0), Position = UDim2.new(1, -310, 0, 20)
    })
    local NotifyLayout = Utility:Create("UIListLayout", {
        Parent = NotifyHolder, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 10), VerticalAlignment = Enum.VerticalAlignment.Bottom
    })

    function Library:Notify(Config)
        local Title = Config.Title or "System"
        local Content = Config.Content or "No content provided."
        local Duration = Config.Duration or 3
        
        local Card = Utility:Create("Frame", {
            Parent = NotifyHolder, BackgroundColor3 = Library.Theme.Secondary,
            Size = UDim2.new(1, 0, 0, 0), BorderSizePixel = 0, ClipsDescendants = true
        })
        Utility:Round(Card, 8)
        Utility:Stroke(Card, Library.Theme.Stroke, 1)
        
        local AccentBar = Utility:Create("Frame", {
            Parent = Card, BackgroundColor3 = Library.Theme.Accent,
            Size = UDim2.new(0, 4, 1, 0)
        })
        Utility:Round(AccentBar, 8)

        local T = Utility:Create("TextLabel", {
            Parent = Card, Text = Title, Font = Enum.Font.GothamBold, TextSize = 14,
            TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
            Size = UDim2.new(1, -20, 0, 20), Position = UDim2.new(0, 15, 0, 5), TextXAlignment = Enum.TextXAlignment.Left
        })
        local C = Utility:Create("TextLabel", {
            Parent = Card, Text = Content, Font = Enum.Font.Gotham, TextSize = 13,
            TextColor3 = Library.Theme.TextDark, BackgroundTransparency = 1,
            Size = UDim2.new(1, -20, 0, 0), Position = UDim2.new(0, 15, 0, 25), TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true
        })

        -- Auto Size
        local TextHeight = game:GetService("TextService"):GetTextSize(Content, 13, Enum.Font.Gotham, Vector2.new(280, 1000)).Y
        local TargetSize = TextHeight + 40

        Utility:Tween(Card, {Size = UDim2.new(1, 0, 0, TargetSize)}, 0.3)
        
        task.delay(Duration, function()
            Utility:Tween(Card, {Size = UDim2.new(1, 0, 0, 0), BackgroundTransparency = 1}, 0.3)
            Utility:Tween(T, {TextTransparency = 1}, 0.2)
            Utility:Tween(C, {TextTransparency = 1}, 0.2)
            task.wait(0.3)
            Card:Destroy()
        end)
    end

    -- // TAB HANDLING \\ --
    local WindowFunctions = {CurrentTab = nil}

    function WindowFunctions:CreateTab(TabName)
        local Tab = {}
        
        -- Button
        local TabBtn = Utility:Create("TextButton", {
            Parent = TabContainer, BackgroundColor3 = Library.Theme.Secondary, BackgroundTransparency = 1,
            Size = UDim2.new(1, -15, 0, 34), Text = "", AutoButtonColor = false
        })
        Utility:Round(TabBtn, 6)
        
        local TabLabel = Utility:Create("TextLabel", {
            Parent = TabBtn, Text = TabName, Font = Enum.Font.GothamMedium, TextSize = 13,
            TextColor3 = Library.Theme.TextDark, BackgroundTransparency = 1,
            Size = UDim2.new(1, -20, 1, 0), Position = UDim2.new(0, 10, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
        })

        local Selection = Utility:Create("Frame", {
            Parent = TabBtn, BackgroundColor3 = Library.Theme.Accent, Size = UDim2.new(0, 0, 1, 0), Position = UDim2.new(0, 0, 0, 0), Transparency = 0.8
        })
        Utility:Round(Selection, 6)

        -- Page
        local Page = Utility:Create("ScrollingFrame", {
            Parent = ContentFolder, BackgroundTransparency = 1, Size = UDim2.fromScale(1,1),
            ScrollBarThickness = 3, ScrollBarImageColor3 = Library.Theme.Accent, Visible = false,
            CanvasSize = UDim2.new(0,0,0,0)
        })
        local PageList = Utility:Create("UIListLayout", {Parent = Page, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 10)})
        Utility:Create("UIPadding", {Parent = Page, PaddingRight = UDim.new(0, 6), PaddingBottom = UDim.new(0, 10)})

        PageList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageList.AbsoluteContentSize.Y + 20)
        end)

        -- Switch Logic
        local function Activate()
            if WindowFunctions.CurrentTab then
                Utility:Tween(WindowFunctions.CurrentTab.Label, {TextColor3 = Library.Theme.TextDark})
                Utility:Tween(WindowFunctions.CurrentTab.Selection, {Size = UDim2.new(0, 0, 1, 0)})
                WindowFunctions.CurrentTab.Page.Visible = false
            end

            WindowFunctions.CurrentTab = {Label = TabLabel, Selection = Selection, Page = Page}
            
            Utility:Tween(TabLabel, {TextColor3 = Library.Theme.Accent})
            Utility:Tween(Selection, {Size = UDim2.new(1, 0, 1, 0)})
            Page.Visible = true
        end

        TabBtn.MouseButton1Click:Connect(function()
            Utility:Ripple(TabBtn)
            Activate()
        end)

        if WindowFunctions.CurrentTab == nil then Activate() end

        -- // ELEMENT GENERATORS \\ --

        function Tab:CreateGroupbox(Name)
            local Groupbox = {}
            
            local BoxFrame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 0),
                BorderSizePixel = 0
            })
            Utility:Round(BoxFrame, 6)
            Utility:Stroke(BoxFrame, Library.Theme.Stroke, 1)
            
            local Label = Utility:Create("TextLabel", {
                Parent = BoxFrame, Text = Name, Font = Enum.Font.GothamBold, TextSize = 12,
                TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
                Size = UDim2.new(1, -20, 0, 25), Position = UDim2.new(0, 10, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local Container = Utility:Create("Frame", {
                Parent = BoxFrame, BackgroundTransparency = 1,
                Size = UDim2.new(1, -10, 1, -30), Position = UDim2.new(0, 5, 0, 30)
            })
            local Layout = Utility:Create("UIListLayout", {
                Parent = Container, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 6)
            })
            
            Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                BoxFrame.Size = UDim2.new(1, 0, 0, Layout.AbsoluteContentSize.Y + 40)
            end)
            
            -- Redirect functions to Container
            local function AddElement(func, config)
                config = config or {}
                local oldParent = Page
                Page = Container -- Temporary swap parent
                local ret = func(Tab, config)
                Page = oldParent
                return ret
            end
            
            function Groupbox:CreateLabel(Config) return AddElement(Tab.CreateLabel, Config) end
            function Groupbox:CreateButton(Config) return AddElement(Tab.CreateButton, Config) end
            function Groupbox:CreateToggle(Config) return AddElement(Tab.CreateToggle, Config) end
            function Groupbox:CreateSlider(Config) return AddElement(Tab.CreateSlider, Config) end
            function Groupbox:CreateInput(Config) return AddElement(Tab.CreateInput, Config) end
            function Groupbox:CreateMultiDropdown(Config) return AddElement(Tab.CreateMultiDropdown, Config) end
            function Groupbox:CreateColorPicker(Config) return AddElement(Tab.CreateColorPicker, Config) end
            function Groupbox:CreateKeybind(Config) return AddElement(Tab.CreateKeybind, Config) end
            
            return Groupbox
        end

        function Tab:CreateLabel(Config)
            local Text = Config.Text or "Label"
            local LabelFrame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 26)
            })
            Utility:Round(LabelFrame, 4)
            
            local Label = Utility:Create("TextLabel", {
                Parent = LabelFrame, Text = Text, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Size = UDim2.new(1, -10, 1, 0), Position = UDim2.new(0, 10, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local Funcs = {}
            function Funcs:Set(val) Label.Text = val end
            return Funcs
        end

        function Tab:CreateButton(Config)
            local Name = Config.Name or "Button"
            local Callback = Config.Callback or function() end

            local Btn = Utility:Create("TextButton", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 32),
                Text = "", AutoButtonColor = false
            })
            Utility:Round(Btn, 4)
            Utility:Stroke(Btn, Library.Theme.Stroke)

            Utility:Create("TextLabel", {
                Parent = Btn, Text = Name, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Size = UDim2.new(1, -10, 1, 0), Position = UDim2.new(0, 10, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
            })

            local Icon = Utility:Create("ImageLabel", {
                Parent = Btn, BackgroundTransparency = 1, Image = "rbxassetid://10709791437",
                Size = UDim2.fromOffset(16, 16), Position = UDim2.new(1, -26, 0.5, -8), ImageColor3 = Library.Theme.TextDark
            })

            Btn.MouseEnter:Connect(function() Utility:Tween(Btn, {BackgroundColor3 = Library.Theme.Stroke}) end)
            Btn.MouseLeave:Connect(function() Utility:Tween(Btn, {BackgroundColor3 = Library.Theme.Main}) end)
            Btn.MouseButton1Click:Connect(function()
                Utility:Ripple(Btn)
                Callback()
            end)
        end

        function Tab:CreateToggle(Config)
            local Name = Config.Name or "Toggle"
            local CurrentValue = Config.CurrentValue or false
            local Callback = Config.Callback or function() end
            local Flag = Config.Flag

            local ToggleFrame = Utility:Create("TextButton", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 32),
                Text = "", AutoButtonColor = false
            })
            Utility:Round(ToggleFrame, 4)
            Utility:Stroke(ToggleFrame, Library.Theme.Stroke)

            Utility:Create("TextLabel", {
                Parent = ToggleFrame, Text = Name, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Size = UDim2.new(1, -60, 1, 0), Position = UDim2.new(0, 10, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
            })

            local Switch = Utility:Create("Frame", {
                Parent = ToggleFrame, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(0, 40, 0, 20),
                Position = UDim2.new(1, -50, 0.5, -10)
            })
            Utility:Round(Switch, 4)
            Utility:Stroke(Switch, Library.Theme.Stroke)
            
            local Dot = Utility:Create("Frame", {
                Parent = Switch, BackgroundColor3 = Library.Theme.TextDark, Size = UDim2.new(0, 16, 0, 16),
                Position = UDim2.new(0, 2, 0.5, -8)
            })
            Utility:Round(Dot, 4)

            local function Update()
                if CurrentValue then
                    Utility:Tween(Switch, {BackgroundColor3 = Library.Theme.Accent})
                    Utility:Tween(Dot, {Position = UDim2.new(1, -18, 0.5, -8), BackgroundColor3 = Color3.new(1,1,1)})
                else
                    Utility:Tween(Switch, {BackgroundColor3 = Library.Theme.Main})
                    Utility:Tween(Dot, {Position = UDim2.new(0, 2, 0.5, -8), BackgroundColor3 = Library.Theme.TextDark})
                end
                Library.Flags[Flag or Name] = CurrentValue
                Callback(CurrentValue)
            end

            ToggleFrame.MouseButton1Click:Connect(function()
                Utility:Ripple(ToggleFrame)
                CurrentValue = not CurrentValue
                Update()
            end)

            if CurrentValue then Update() end
            
            local Funcs = {}
            function Funcs:Set(val) CurrentValue = val Update() end
            if Flag then Library.Registry[Flag] = Funcs end
            return Funcs
        end

        function Tab:CreateSlider(Config)
            local Name = Config.Name or "Slider"
            local Min, Max = Config.Range[1], Config.Range[2]
            local Value = Config.CurrentValue or Min
            local Callback = Config.Callback or function() end
            local Flag = Config.Flag

            local SliderFrame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 50)
            })
            Utility:Round(SliderFrame, 4)
            Utility:Stroke(SliderFrame, Library.Theme.Stroke)

            Utility:Create("TextLabel", {
                Parent = SliderFrame, Text = Name, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 8), Size = UDim2.new(1, -20, 0, 20), TextXAlignment = Enum.TextXAlignment.Left
            })

            local InputBox = Utility:Create("TextBox", {
                Parent = SliderFrame, Text = tostring(Value), Font = Enum.Font.GothamBold, TextSize = 12,
                TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
                Position = UDim2.new(1, -60, 0, 8), Size = UDim2.new(0, 50, 0, 20), TextXAlignment = Enum.TextXAlignment.Right
            })

            local Bar = Utility:Create("Frame", {
                Parent = SliderFrame, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, -20, 0, 4),
                Position = UDim2.new(0, 10, 0, 38)
            })
            Utility:Round(Bar, 2)

            local Fill = Utility:Create("Frame", {
                Parent = Bar, BackgroundColor3 = Library.Theme.Accent, Size = UDim2.new((Value-Min)/(Max-Min), 0, 1, 0)
            })
            Utility:Round(Fill, 2)

            local function Update(Input)
                local pos = math.clamp((Input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                Value = math.floor(Min + ((Max - Min) * pos))
                Utility:Tween(Fill, {Size = UDim2.fromScale(pos, 1)}, 0.05)
                InputBox.Text = tostring(Value)
                Library.Flags[Flag or Name] = Value
                Callback(Value)
            end

            local Dragging = false
            SliderFrame.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = true
                    Update(input)
                end
            end)
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then Dragging = false end
            end)
            UserInputService.InputChanged:Connect(function(input)
                if Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then Update(input) end
            end)
            
            InputBox.FocusLost:Connect(function()
                local n = tonumber(InputBox.Text)
                if n then
                    Value = math.clamp(n, Min, Max)
                    local ratio = (Value - Min) / (Max - Min)
                    Utility:Tween(Fill, {Size = UDim2.fromScale(ratio, 1)}, 0.2)
                    Callback(Value)
                end
                InputBox.Text = tostring(Value)
                Library.Flags[Flag or Name] = Value
            end)
            
            local Funcs = {}
            function Funcs:Set(val)
                Value = math.clamp(val, Min, Max)
                local ratio = (Value - Min) / (Max - Min)
                Utility:Tween(Fill, {Size = UDim2.fromScale(ratio, 1)}, 0.2)
                InputBox.Text = tostring(Value)
                Library.Flags[Flag or Name] = Value
                Callback(Value)
            end
            if Flag then Library.Registry[Flag] = Funcs end
            return Funcs
        end

        function Tab:CreateMultiDropdown(Config)
            local Name = Config.Name or "Multi Dropdown"
            local Options = Config.Options or {}
            local Callback = Config.Callback or function() end
            local Flag = Config.Flag
            local Selected = {}

            local ClosedHeight = 32
            local Open = false

            local DropFrame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, ClosedHeight),
                ClipsDescendants = true
            })
            Utility:Round(DropFrame, 4)
            Utility:Stroke(DropFrame, Library.Theme.Stroke)

            local Interact = Utility:Create("TextButton", {
                Parent = DropFrame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, ClosedHeight),
                Text = "", AutoButtonColor = false
            })

            local Label = Utility:Create("TextLabel", {
                Parent = Interact, Text = Name, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(1, -40, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })

            local Arrow = Utility:Create("ImageLabel", {
                Parent = Interact, Image = "rbxassetid://6031091004", BackgroundTransparency = 1,
                ImageColor3 = Library.Theme.TextDark, Size = UDim2.fromOffset(16, 16), Position = UDim2.new(1, -26, 0.5, -8)
            })

            local Container = Utility:Create("ScrollingFrame", {
                Parent = DropFrame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, -34), Position = UDim2.new(0, 0, 0, 34),
                ScrollBarThickness = 2, CanvasSize = UDim2.new(0,0,0,0)
            })
            local Layout = Utility:Create("UIListLayout", {Parent = Container, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 2)})

            local function UpdateText()
                local s = {}
                for k,v in pairs(Selected) do if v then table.insert(s, k) end end
                local txt = table.concat(s, ", ")
                if txt == "" then txt = "None" end
                Label.Text = Name .. ": " .. txt
                Library.Flags[Flag or Name] = Selected
                Callback(Selected)
            end

            for _, opt in pairs(Options) do
                local OptBtn = Utility:Create("TextButton", {
                    Parent = Container, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 26),
                    Text = "", AutoButtonColor = false
                })
                
                local Check = Utility:Create("Frame", {
                    Parent = OptBtn, BackgroundColor3 = Library.Theme.Main, Size = UDim2.fromOffset(14, 14),
                    Position = UDim2.new(0, 10, 0.5, -7)
                })
                Utility:Round(Check, 2)
                Utility:Stroke(Check, Library.Theme.Stroke, 1)

                Utility:Create("TextLabel", {
                    Parent = OptBtn, Text = opt, Font = Enum.Font.Gotham, TextSize = 13,
                    TextColor3 = Library.Theme.TextDark, BackgroundTransparency = 1,
                    Position = UDim2.new(0, 35, 0, 0), Size = UDim2.new(1, -35, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
                })

                OptBtn.MouseButton1Click:Connect(function()
                    if Selected[opt] then
                        Selected[opt] = nil
                        Utility:Tween(Check, {BackgroundColor3 = Library.Theme.Main})
                        Utility:Tween(OptBtn.TextLabel, {TextColor3 = Library.Theme.TextDark})
                    else
                        Selected[opt] = true
                        Utility:Tween(Check, {BackgroundColor3 = Library.Theme.Accent})
                        Utility:Tween(OptBtn.TextLabel, {TextColor3 = Library.Theme.Text})
                    end
                    UpdateText()
                end)
            end
            Container.CanvasSize = UDim2.new(0, 0, 0, Layout.AbsoluteContentSize.Y)

            Interact.MouseButton1Click:Connect(function()
                Open = not Open
                local ContentHeight = math.min(Layout.AbsoluteContentSize.Y + 40, 200)
                Utility:Tween(DropFrame, {Size = UDim2.new(1, 0, 0, Open and ContentHeight or ClosedHeight)})
                Utility:Tween(Arrow, {Rotation = Open and 180 or 0})
            end)
            
            local Funcs = {}
            function Funcs:Set(val)
                Selected = val or {}
                -- Visual update logic omitted for brevity, but would go here
                UpdateText()
            end
            if Flag then Library.Registry[Flag] = Funcs end
            return Funcs
        end

        function Tab:CreateInput(Config)
            local Name = Config.Name or "Input"
            local Placeholder = Config.Placeholder or "Type here..."
            local Callback = Config.Callback or function() end
            local Flag = Config.Flag

            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 36)
            })
            Utility:Round(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Stroke)

            Utility:Create("TextLabel", {
                Parent = Frame, Text = Name, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(0, 100, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })

            local Box = Utility:Create("TextBox", {
                Parent = Frame, BackgroundColor3 = Library.Theme.Secondary, TextColor3 = Library.Theme.Text,
                Text = "", PlaceholderText = Placeholder, Font = Enum.Font.Gotham, TextSize = 13,
                Size = UDim2.new(0, 150, 0, 22), Position = UDim2.new(1, -160, 0.5, -11)
            })
            Utility:Round(Box, 2)
            Utility:Stroke(Box, Library.Theme.Stroke)

            Box.FocusLost:Connect(function(enter)
                if enter then 
                    Library.Flags[Flag or Name] = Box.Text
                    Callback(Box.Text) 
                end
            end)
            
            local Funcs = {}
            function Funcs:Set(val) Box.Text = val Library.Flags[Flag or Name] = val Callback(val) end
            if Flag then Library.Registry[Flag] = Funcs end
            return Funcs
        end

        function Tab:CreateColorPicker(Config)
            local Name = Config.Name or "Color Picker"
            local Default = Config.Color or Color3.fromRGB(255, 255, 255)
            local Callback = Config.Callback or function() end
            local Flag = Config.Flag

            local H, S, V = Default:ToHSV()
            local Open = false

            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 32),
                ClipsDescendants = true
            })
            Utility:Round(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Stroke)

            local ToggleBtn = Utility:Create("TextButton", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 32), Text = ""
            })

            Utility:Create("TextLabel", {
                Parent = ToggleBtn, Text = Name, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(1, -50, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })

            local Preview = Utility:Create("Frame", {
                Parent = ToggleBtn, BackgroundColor3 = Default, Size = UDim2.fromOffset(20, 20),
                Position = UDim2.new(1, -30, 0.5, -10)
            })
            Utility:Round(Preview, 4)
            Utility:Stroke(Preview, Library.Theme.Stroke)

            -- Picker Container
            local PickerArea = Utility:Create("Frame", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 130), Position = UDim2.new(0, 0, 0, 32)
            })

            local SVImg = Utility:Create("ImageLabel", {
                Parent = PickerArea, Image = "rbxassetid://4155801252", Size = UDim2.new(0, 130, 0, 100),
                Position = UDim2.new(0, 10, 0, 10), BackgroundTransparency = 1
            })
            local Cursor = Utility:Create("Frame", {
                Parent = SVImg, BackgroundColor3 = Color3.new(1,1,1), Size = UDim2.fromOffset(4, 4),
                Position = UDim2.fromScale(S, 1-V)
            })
            
            local HueBar = Utility:Create("ImageLabel", {
                Parent = PickerArea, Image = "rbxassetid://328298876", Size = UDim2.new(0, 20, 0, 100),
                Position = UDim2.new(0, 150, 0, 10)
            })
            local HueSlide = Utility:Create("Frame", {
                Parent = HueBar, BackgroundColor3 = Color3.new(1,1,1), Size = UDim2.new(1, 2, 0, 2),
                Position = UDim2.fromScale(0, 1-H)
            })

            local function UpdateColor()
                local NewColor = Color3.fromHSV(H, S, V)
                Preview.BackgroundColor3 = NewColor
                SVImg.ImageColor3 = Color3.fromHSV(H, 1, 1)
                Library.Flags[Flag or Name] = NewColor
                Callback(NewColor)
            end

            -- Hue Logic
            local DraggingHue = false
            HueBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    DraggingHue = true
                    local y = math.clamp((input.Position.Y - HueBar.AbsolutePosition.Y) / HueBar.AbsoluteSize.Y, 0, 1)
                    H = 1 - y
                    HueSlide.Position = UDim2.fromScale(0, y)
                    UpdateColor()
                end
            end)
            UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then DraggingHue = false end end)
            UserInputService.InputChanged:Connect(function(input)
                if DraggingHue and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local y = math.clamp((input.Position.Y - HueBar.AbsolutePosition.Y) / HueBar.AbsoluteSize.Y, 0, 1)
                    H = 1 - y
                    HueSlide.Position = UDim2.fromScale(0, y)
                    UpdateColor()
                end
            end)

            -- SV Logic
            local DraggingSV = false
            SVImg.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    DraggingSV = true
                    local x = math.clamp((input.Position.X - SVImg.AbsolutePosition.X) / SVImg.AbsoluteSize.X, 0, 1)
                    local y = math.clamp((input.Position.Y - SVImg.AbsolutePosition.Y) / SVImg.AbsoluteSize.Y, 0, 1)
                    S = x
                    V = 1 - y
                    Cursor.Position = UDim2.fromScale(x, y)
                    UpdateColor()
                end
            end)
            UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then DraggingSV = false end end)
            UserInputService.InputChanged:Connect(function(input)
                if DraggingSV and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local x = math.clamp((input.Position.X - SVImg.AbsolutePosition.X) / SVImg.AbsoluteSize.X, 0, 1)
                    local y = math.clamp((input.Position.Y - SVImg.AbsolutePosition.Y) / SVImg.AbsoluteSize.Y, 0, 1)
                    S = x
                    V = 1 - y
                    Cursor.Position = UDim2.fromScale(x, y)
                    UpdateColor()
                end
            end)

            ToggleBtn.MouseButton1Click:Connect(function()
                Open = not Open
                Utility:Tween(Frame, {Size = UDim2.new(1, 0, 0, Open and 162 or 32)})
            end)
            
            local Funcs = {}
            function Funcs:Set(val)
                H, S, V = val:ToHSV()
                UpdateColor()
            end
            if Flag then Library.Registry[Flag] = Funcs end
            return Funcs
        end

        function Tab:CreateKeybind(Config)
            local Name = Config.Name or "Keybind"
            local Default = Config.Default or Enum.KeyCode.RightControl
            local Callback = Config.Callback or function() end
            local Flag = Config.Flag
            
            local CurrentKey = Default
            local Listening = false

            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 32)
            })
            Utility:Round(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Stroke)

            Utility:Create("TextLabel", {
                Parent = Frame, Text = Name, Font = Enum.Font.Gotham, TextSize = 13,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(1, -10, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })

            local BindBtn = Utility:Create("TextButton", {
                Parent = Frame, BackgroundColor3 = Library.Theme.Secondary, TextColor3 = Library.Theme.Accent,
                Text = Default.Name, Font = Enum.Font.GothamBold, TextSize = 12,
                Size = UDim2.new(0, 80, 0, 24), Position = UDim2.new(1, -90, 0.5, -12)
            })
            Utility:Round(BindBtn, 2)
            Utility:Stroke(BindBtn, Library.Theme.Stroke)

            BindBtn.MouseButton1Click:Connect(function()
                Listening = true
                BindBtn.Text = "..."
                Utility:Tween(BindBtn, {TextColor3 = Library.Theme.TextDark})
            end)

            UserInputService.InputBegan:Connect(function(input)
                if Listening then
                    if input.UserInputType == Enum.UserInputType.Keyboard then
                        CurrentKey = input.KeyCode
                        BindBtn.Text = CurrentKey.Name
                        Listening = false
                        Library.Flags[Flag or Name] = CurrentKey
                        Utility:Tween(BindBtn, {TextColor3 = Library.Theme.Accent})
                    end
                elseif input.KeyCode == CurrentKey then
                    Callback()
                end
            end)
            
            local Funcs = {}
            function Funcs:Set(val) CurrentKey = val BindBtn.Text = val.Name end
            if Flag then Library.Registry[Flag] = Funcs end
            return Funcs
        end

        return Tab
    end
    
    -- // STATUS PANEL \\ --
    function WindowFunctions:CreateStatusPanel(Config)
        local Panel = Utility:Create("Frame", {
            Parent = ScreenGui,
            BackgroundColor3 = Library.Theme.Main,
            Size = UDim2.new(0, 200, 0, 100),
            Position = UDim2.new(0.85, 0, 0.5, 0),
            Visible = false
        })
        Utility:Round(Panel, 6)
        Utility:Stroke(Panel, Library.Theme.Outline, 2)
        Utility:Drag(Panel)
        
        -- Header
        local Header = Utility:Create("Frame", {
            Parent = Panel, BackgroundColor3 = Library.Theme.Secondary,
            Size = UDim2.new(1, 0, 0, 25)
        })
        Utility:Round(Header, 6)
        Utility:Create("Frame", {Parent = Header, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 5), Position = UDim2.new(0,0,1,-5), BorderSizePixel=0})
        
        local Title = Utility:Create("TextLabel", {
            Parent = Header, Text = Config.Title or "Status", Font = Enum.Font.GothamBold, TextSize = 12,
            TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0), TextXAlignment = Enum.TextXAlignment.Center
        })
        
        local Container = Utility:Create("Frame", {
            Parent = Panel, BackgroundTransparency = 1,
            Size = UDim2.new(1, -10, 1, -30), Position = UDim2.new(0, 5, 0, 30)
        })
        local List = Utility:Create("UIListLayout", {Parent = Container, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)})
        
        List:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Panel.Size = UDim2.new(0, 200, 0, List.AbsoluteContentSize.Y + 35)
        end)
        
        local Items = {}
        local Funcs = {}
        
        function Funcs:Add(id, name)
            local Row = Utility:Create("Frame", {
                Parent = Container, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 18)
            })
            local N = Utility:Create("TextLabel", {
                Parent = Row, Text = name, Font = Enum.Font.Gotham, TextSize = 12,
                TextColor3 = Library.Theme.TextDark, BackgroundTransparency = 1,
                Size = UDim2.new(0.6, 0, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            local V = Utility:Create("TextLabel", {
                Parent = Row, Text = "-", Font = Enum.Font.GothamBold, TextSize = 12,
                TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
                Size = UDim2.new(0.4, 0, 1, 0), Position = UDim2.new(0.6, 0, 0, 0), TextXAlignment = Enum.TextXAlignment.Right
            })
            Items[id] = V
        end
        
        function Funcs:Update(id, val)
            if Items[id] then Items[id].Text = tostring(val) end
        end
        
        function Funcs:Toggle(bool)
            Panel.Visible = bool
        end
        
        return Funcs
    end

    -- // DASHBOARD \\ --
    function WindowFunctions:ShowDashboard()
        local Dash = WindowFunctions:CreateTab("Dashboard")
        
        local Info = Dash:CreateGroupbox("User Information")
        Info:CreateLabel({Text = "Welcome, " .. Players.LocalPlayer.DisplayName})
        Info:CreateLabel({Text = "Account Age: " .. Players.LocalPlayer.AccountAge .. " days"})
        Info:CreateLabel({Text = "Executor: " .. (identifyexecutor and identifyexecutor() or "Unknown")})
        
        local Stats = Dash:CreateGroupbox("Server Statistics")
        local PingLbl = Stats:CreateLabel({Text = "Ping: ..."})
        local FpsLbl = Stats:CreateLabel({Text = "FPS: ..."})
        local TimeLbl = Stats:CreateLabel({Text = "Time: ..."})
        
        task.spawn(function()
            while ScreenGui.Parent do
                local ping = math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue())
                local fps = math.floor(workspace:GetRealPhysicsFPS())
                PingLbl:Set("Ping: " .. ping .. " ms")
                FpsLbl:Set("FPS: " .. fps)
                TimeLbl:Set("Time: " .. os.date("%X"))
                task.wait(1)
            end
        end)
        
        local Settings = Dash:CreateGroupbox("Configuration")
        local ConfigName = ""
        Settings:CreateInput({Name = "Config Name", Placeholder = "Enter name...", Callback = function(v) ConfigName = v end})
        
        Settings:CreateButton({Name = "Save Config", Callback = function()
            ConfigManager:Save(ConfigName)
        end})
        
        Settings:CreateButton({Name = "Load Config", Callback = function()
            ConfigManager:Load(ConfigName)
        end})
        
        local Drop = Settings:CreateMultiDropdown({Name = "Available Configs", Options = ConfigManager:GetConfigs(), Callback = function(v) 
            -- Logic to select config
        end})
        
        Settings:CreateButton({Name = "Refresh Configs", Callback = function()
            -- Refresh logic would require recreating the dropdown, simplified here
            Library:Notify({Title = "System", Content = "Configs refreshed (re-open UI to see)", Duration = 2})
        end})
    end

    return WindowFunctions
end

return Library
