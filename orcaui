--[[
    üê≤ CerberusUI: Professional CS:GO Style Interface Library
    Author: OrcaDev (Refined)
    
    Features:
    - CS:GO Inspired Dark Theme
    - Full Configuration Saving/Loading System
    - Live-Updating Draggable Dashboard
    - Advanced Color Picker & Keybinds
    - Searchable Multi-Dropdowns
    - Tooltip System
]]

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- // FILE SYSTEM (For Configs) \\ --
local function isfile(path) return pcall(function() readfile(path) end) end
local function makefolder(path) pcall(function() makefolder(path) end) end
local function listfiles(path) local s, f = pcall(function() return listfiles(path) end) return s and f or {} end
local function writefile(path, data) pcall(function() writefile(path, data) end) end
local function readfile(path) local s, d = pcall(function() return readfile(path) end) return s and d or nil end
local function isfolder(path) return pcall(function() listfiles(path) end) end
local function delfile(path) pcall(function() delfile(path) end) end

local ConfigFolder = "CerberusConfigs"
makefolder(ConfigFolder)

-- // LIBRARY ROOT \\ --
local Library = {
    Flags = {},
    Theme = {
        Main        = Color3.fromRGB(20, 20, 20),
        Secondary   = Color3.fromRGB(30, 30, 30),
        Accent      = Color3.fromRGB(50, 255, 100), -- Neon Green
        Text        = Color3.fromRGB(240, 240, 240),
        SubText     = Color3.fromRGB(150, 150, 150),
        Hover       = Color3.fromRGB(40, 40, 40),
        Border      = Color3.fromRGB(60, 60, 60),
        Font        = Enum.Font.SourceSans,
        FontBold    = Enum.Font.SourceSansBold
    },
    Config = {}
}

-- // UTILITIES \\ --
local Utility = {}

function Utility:GetParent() return (gethui and gethui()) or CoreGui end

function Utility:Create(instanceType, properties, children)
    local obj = Instance.new(instanceType)
    for k, v in pairs(properties or {}) do obj[k] = v end
    if children then for _, child in pairs(children) do child.Parent = obj end end
    return obj
end

function Utility:Stroke(obj, color, thickness)
    local stroke = Utility:Create("UIStroke", {
        Color = color or Library.Theme.Border,
        Thickness = thickness or 1,
        Parent = obj
    })
    return stroke
end

function Utility:Corner(obj, radius)
    return Utility:Create("UICorner", {
        CornerRadius = UDim.new(0, radius or 4),
        Parent = obj
    })
end

function Utility:Tween(obj, props, time, style, dir)
    TweenService:Create(obj, TweenInfo.new(time or 0.2, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out), props):Play()
end

function Utility:Drag(frame, parent)
    parent = parent or frame
    local dragging, dragInput, dragStart, startPos
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = parent.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)
    frame.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Utility:Tween(parent, {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}, 0.05)
        end
    end)
end

function Utility:Tooltip(hover_obj, text)
    local tooltip = Utility:Create("Frame", {
        Name = "Tooltip", Parent = (gethui and gethui()) or CoreGui, BackgroundColor3 = Library.Theme.Main,
        Size = UDim2.fromOffset(0, 26), ZIndex = 10, Visible = false
    })
    Utility:Stroke(tooltip, Library.Theme.Accent)
    Utility:Corner(tooltip, 4)
    local label = Utility:Create("TextLabel", {
        Parent = tooltip, Text = text, Font = Library.Theme.Font, TextSize = 13,
        TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
        Size = UDim2.new(1, -10, 1, 0), Position = UDim2.new(0, 5, 0, 0)
    })
    local size = game:GetService("TextService"):GetTextSize(text, 13, Library.Theme.Font, Vector2.new(300, 30))
    tooltip.Size = UDim2.fromOffset(size.X + 14, 26)

    hover_obj.MouseEnter:Connect(function()
        tooltip.Visible = true
        while tooltip.Visible do
            tooltip.Position = UDim2.fromOffset(Mouse.X + 15, Mouse.Y)
            RunService.Heartbeat:Wait()
        end
    end)
    hover_obj.MouseLeave:Connect(function() tooltip.Visible = false end)
end

-- // CONFIGURATION SYSTEM \\ --
function Library:SaveConfig(name)
    local data = {}
    for flag, value in pairs(Library.Flags) do
        if typeof(value) == "Color3" then
            data[flag] = {R = value.R, G = value.G, B = value.B, Type = "Color"}
        elseif typeof(value) == "EnumItem" then
            data[flag] = {Name = value.Name, Type = "Enum", EnumType = tostring(value.EnumType)}
        else
            data[flag] = value
        end
    end
    writefile(ConfigFolder .. "/" .. name .. ".json", HttpService:JSONEncode(data))
end

function Library:LoadConfig(name)
    if not isfile(ConfigFolder .. "/" .. name .. ".json") then return end
    local data = HttpService:JSONDecode(readfile(ConfigFolder .. "/" .. name .. ".json"))
    for flag, value in pairs(data) do
        if type(value) == "table" and value.Type == "Color" then
            Library.Flags[flag] = Color3.new(value.R, value.G, value.B)
        elseif type(value) == "table" and value.Type == "Enum" then
            local enumType = value.EnumType:split(".")[2]
            Library.Flags[flag] = Enum[enumType][value.Name]
        else
            Library.Flags[flag] = value
        end
        -- Trigger the callback to update the UI element
        if Library.Config[flag] then Library.Config[flag](Library.Flags[flag]) end
    end
end

function Library:GetConfigs()
    local configs = {}
    for _, file in pairs(listfiles(ConfigFolder)) do
        if file:sub(-5) == ".json" then
            table.insert(configs, file:match("([^\\]+)%.json$"))
        end
    end
    return configs
end

-- // DASHBOARD MODULE \\ --
function Library:CreateDashboard(Config)
    local Title = Config.Title or "Dashboard"
    local Size = Config.Size or UDim2.fromOffset(300, 200)
    
    local DashGui = Utility:Create("ScreenGui", {Name = "CerberusDash", Parent = Utility:GetParent(), ZIndexBehavior = Enum.ZIndexBehavior.Sibling})
    
    local Main = Utility:Create("Frame", {
        Name = "Main", Parent = DashGui, BackgroundColor3 = Library.Theme.Main,
        Size = Size, Position = UDim2.new(0.8, 0, 0.1, 0), BackgroundTransparency = 0.1
    })
    Utility:Corner(Main, 6)
    Utility:Stroke(Main, Library.Theme.Accent)
    
    local Header = Utility:Create("Frame", {
        Parent = Main, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 30)
    })
    Utility:Corner(Header, 6)
    Utility:Create("Frame", { -- Flat Bottom
        Parent = Header, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0.5, 0),
        Position = UDim2.new(0, 0, 0.5, 0), BorderSizePixel = 0
    })
    Utility:Drag(Header, Main)
    
    Utility:Create("TextLabel", {
        Parent = Header, Text = Title, Font = Library.Theme.FontBold, TextSize = 14,
        TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
        Size = UDim2.new(1, -10, 1, 0), Position = UDim2.new(0, 10, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local Container = Utility:Create("ScrollingFrame", {
        Parent = Main, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, -35), Position = UDim2.new(0, 0, 0, 35),
        ScrollBarThickness = 2, ScrollBarImageColor3 = Library.Theme.Accent, CanvasSize = UDim2.new(0,0,0,0)
    })
    local Layout = Utility:Create("UIListLayout", {Parent = Container, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)})
    Utility:Create("UIPadding", {Parent = Container, PaddingLeft = UDim.new(0, 5), PaddingRight = UDim.new(0, 5), PaddingTop = UDim.new(0, 5)})

    Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Container.CanvasSize = UDim2.new(0, 0, 0, Layout.AbsoluteContentSize.Y + 10)
    end)

    local DashFuncs = {}

    function DashFuncs:AddSection(Text)
        local Section = Utility:Create("Frame", {
            Parent = Container, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 24)
        })
        Utility:Corner(Section, 4)
        Utility:Create("TextLabel", {
            Parent = Section, Text = Text, Font = Library.Theme.FontBold, TextSize = 13,
            TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
            Size = UDim2.new(1, -10, 1, 0), Position = UDim2.new(0, 5, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
        })
        return Section
    end

    function DashFuncs:AddLabel(Text)
        local Label = Utility:Create("TextLabel", {
            Parent = Container, Text = Text, Font = Library.Theme.Font, TextSize = 13,
            TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 0, 18), TextXAlignment = Enum.TextXAlignment.Left, TextWrapped = true
        })
        return Label
    end

    -- Default Nearby Players Module
    DashFuncs:AddSection("Nearby Players")
    local PlayerList = Utility:Create("Frame", {
        Parent = Container, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 100)
    })
    local PlayerLayout = Utility:Create("UIListLayout", {Parent = PlayerList, SortOrder = Enum.SortOrder.LayoutOrder})
    
    task.spawn(function()
        while DashGui.Parent do
            for _, child in pairs(PlayerList:GetChildren()) do if child:IsA("TextLabel") then child:Destroy() end end
            
            local nearby = {}
            for _, plr in pairs(Players:GetPlayers()) do
                if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    local dist = (LocalPlayer.Character.HumanoidRootPart.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                    table.insert(nearby, {Name = plr.Name, Dist = math.floor(dist)})
                end
            end
            table.sort(nearby, function(a, b) return a.Dist < b.Dist end)
            
            for i, data in ipairs(nearby) do
                if i > 5 then break end
                local pLabel = Utility:Create("TextLabel", {
                    Parent = PlayerList, Text = data.Name .. " [" .. data.Dist .. "s]",
                    Font = Library.Theme.Font, TextSize = 13, TextColor3 = Library.Theme.Text,
                    BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 18), TextXAlignment = Enum.TextXAlignment.Left
                })
                if data.Dist < 50 then pLabel.TextColor3 = Color3.fromRGB(255, 50, 50) end
            end
            PlayerList.Size = UDim2.new(1, 0, 0, PlayerLayout.AbsoluteContentSize.Y)
            task.wait(0.5)
        end
    end)

    return DashFuncs
end

-- // MAIN WINDOW MODULE \\ --
function Library:CreateWindow(Config)
    local Title = Config.Title or "Cerberus"
    local Size = Config.Size or UDim2.fromOffset(700, 450)
    
    local ScreenGui = Utility:Create("ScreenGui", {Name = "CerberusUI", Parent = Utility:GetParent(), ZIndexBehavior = Enum.ZIndexBehavior.Sibling})
    
    local Main = Utility:Create("Frame", {
        Name = "Main", Parent = ScreenGui, BackgroundColor3 = Library.Theme.Main,
        Position = UDim2.fromScale(0.5, 0.5), Size = Size, AnchorPoint = Vector2.new(0.5, 0.5)
    })
    Utility:Corner(Main, 6)
    Utility:Stroke(Main, Library.Theme.Accent, 2)

    -- Topbar & Title Fix
    local Topbar = Utility:Create("Frame", {
        Parent = Main, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 40)
    })
    Utility:Corner(Topbar, 6)
    Utility:Create("Frame", { -- Flat Bottom
        Parent = Topbar, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0.5, 0),
        Position = UDim2.new(0, 0, 0.5, 0), BorderSizePixel = 0
    })
    Utility:Drag(Topbar, Main)

    local TitleLabel = Utility:Create("TextLabel", {
        Parent = Topbar, Text = Title, Font = Library.Theme.FontBold, TextSize = 18,
        TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
        Size = UDim2.new(0, 200, 1, 0), Position = UDim2.new(0, 15, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local VersionLabel = Utility:Create("TextLabel", {
        Parent = Topbar, Text = "BUILD: " .. os.date("%Y.%m.%d"), Font = Library.Theme.Font, TextSize = 12,
        TextColor3 = Library.Theme.SubText, BackgroundTransparency = 1,
        Size = UDim2.new(0, 100, 1, 0), Position = UDim2.new(1, -115, 0, 0), TextXAlignment = Enum.TextXAlignment.Right
    })

    -- Sidebar
    local Sidebar = Utility:Create("ScrollingFrame", {
        Parent = Main, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(0, 160, 1, -40),
        Position = UDim2.new(0, 0, 0, 40), ScrollBarThickness = 2, ScrollBarImageColor3 = Library.Theme.Accent,
        CanvasSize = UDim2.new(0,0,0,0)
    })
    local SideLayout = Utility:Create("UIListLayout", {Parent = Sidebar, Padding = UDim.new(0, 5), SortOrder = Enum.SortOrder.LayoutOrder})
    Utility:Create("UIPadding", {Parent = Sidebar, PaddingTop = UDim.new(0, 10), PaddingLeft = UDim.new(0, 10), PaddingRight = UDim.new(0, 10)})

    SideLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Sidebar.CanvasSize = UDim2.new(0, 0, 0, SideLayout.AbsoluteContentSize.Y + 20)
    end)

    -- Content Area
    local Content = Utility:Create("Frame", {
        Parent = Main, BackgroundTransparency = 1, Size = UDim2.new(1, -170, 1, -50),
        Position = UDim2.new(0, 170, 0, 50)
    })
    local ContentFolder = Utility:Create("Folder", {Parent = Content})

    local Tabs = {Current = nil}

    function Tabs:CreateTab(Name, IconId)
        local Tab = {}
        
        local TabBtn = Utility:Create("TextButton", {
            Parent = Sidebar, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 35),
            Text = "", AutoButtonColor = false
        })
        Utility:Corner(TabBtn, 4)
        local BtnStroke = Utility:Stroke(TabBtn, Library.Theme.Border, 1)
        
        local BtnText = Utility:Create("TextLabel", {
            Parent = TabBtn, Text = Name, Font = Library.Theme.FontBold, TextSize = 14,
            TextColor3 = Library.Theme.SubText, BackgroundTransparency = 1,
            Size = UDim2.new(1, -35, 1, 0), Position = UDim2.new(0, 35, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
        })

        if IconId then
            Utility:Create("ImageLabel", {
                Parent = TabBtn, Image = "rbxassetid://" .. IconId, BackgroundTransparency = 1,
                Size = UDim2.fromOffset(20, 20), Position = UDim2.new(0, 8, 0.5, -10), ImageColor3 = Library.Theme.SubText
            })
        end

        local Page = Utility:Create("ScrollingFrame", {
            Parent = ContentFolder, BackgroundTransparency = 1, Size = UDim2.fromScale(1, 1), Visible = false,
            ScrollBarThickness = 2, ScrollBarImageColor3 = Library.Theme.Accent, CanvasSize = UDim2.new(0,0,0,0)
        })
        local PageLayout = Utility:Create("UIListLayout", {Parent = Page, Padding = UDim.new(0, 8), SortOrder = Enum.SortOrder.LayoutOrder})
        Utility:Create("UIPadding", {Parent = Page, PaddingRight = UDim.new(0, 8), PaddingBottom = UDim.new(0, 10)})

        PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 20)
        end)

        local function Activate()
            if Tabs.Current then
                Utility:Tween(Tabs.Current.BtnText, {TextColor3 = Library.Theme.SubText})
                Utility:Tween(Tabs.Current.BtnStroke, {Color = Library.Theme.Border})
                Tabs.Current.Page.Visible = false
            end
            Tabs.Current = {BtnText = BtnText, BtnStroke = BtnStroke, Page = Page}
            Utility:Tween(BtnText, {TextColor3 = Library.Theme.Accent})
            Utility:Tween(BtnStroke, {Color = Library.Theme.Accent})
            Page.Visible = true
        end

        TabBtn.MouseButton1Click:Connect(Activate)
        if Tabs.Current == nil then Activate() end

        -- // ELEMENTS \\ --
        function Tab:CreateSection(Text)
            local Section = Utility:Create("Frame", {Parent = Page, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 30)})
            local Label = Utility:Create("TextLabel", {
                Parent = Section, Text = Text, Font = Library.Theme.FontBold, TextSize = 14,
                TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            Utility:Create("Frame", {
                Parent = Section, BackgroundColor3 = Library.Theme.Border, Size = UDim2.new(1, -(Label.TextBounds.X + 15), 0, 1),
                Position = UDim2.new(0, Label.TextBounds.X + 10, 0.5, 0), BorderSizePixel = 0
            })
        end

        function Tab:CreateToggle(Config)
            local Name = Config.Name or "Toggle"
            local Flag = Config.Flag or Name
            local Default = Config.CurrentValue or false
            local Callback = Config.Callback or function() end
            local Tooltip = Config.Tooltip

            Library.Flags[Flag] = Default

            local Frame = Utility:Create("TextButton", {
                Parent = Page, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 36),
                Text = "", AutoButtonColor = false
            })
            Utility:Corner(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Border)

            Utility:Create("TextLabel", {
                Parent = Frame, Text = Name, Font = Library.Theme.Font, TextSize = 14,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Size = UDim2.new(1, -50, 1, 0), Position = UDim2.new(0, 10, 0, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local Switch = Utility:Create("Frame", {
                Parent = Frame, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(0, 36, 0, 18),
                Position = UDim2.new(1, -46, 0.5, -9)
            })
            Utility:Corner(Switch, 9)
            local SwitchStroke = Utility:Stroke(Switch, Library.Theme.Border)
            
            local Dot = Utility:Create("Frame", {
                Parent = Switch, BackgroundColor3 = Library.Theme.SubText, Size = UDim2.new(0, 14, 0, 14),
                Position = UDim2.new(0, 2, 0.5, -7)
            })
            Utility:Corner(Dot, 7)

            if Tooltip then Utility:Tooltip(Frame, Tooltip) end

            local function Update(val)
                Library.Flags[Flag] = val
                if val then
                    Utility:Tween(Switch, {BackgroundColor3 = Library.Theme.Accent})
                    Utility:Tween(SwitchStroke, {Color = Library.Theme.Accent})
                    Utility:Tween(Dot, {Position = UDim2.new(1, -16, 0.5, -7), BackgroundColor3 = Library.Theme.Main})
                else
                    Utility:Tween(Switch, {BackgroundColor3 = Library.Theme.Main})
                    Utility:Tween(SwitchStroke, {Color = Library.Theme.Border})
                    Utility:Tween(Dot, {Position = UDim2.new(0, 2, 0.5, -7), BackgroundColor3 = Library.Theme.SubText})
                end
                Callback(val)
            end

            Frame.MouseButton1Click:Connect(function() Update(not Library.Flags[Flag]) end)
            Library.Config[Flag] = Update
            Update(Library.Flags[Flag])
        end

        function Tab:CreateSlider(Config)
            local Name = Config.Name or "Slider"
            local Flag = Config.Flag or Name
            local Min, Max = Config.Range[1] or 0, Config.Range[2] or 100
            local Default = Config.CurrentValue or Min
            local Callback = Config.Callback or function() end
            local Tooltip = Config.Tooltip

            Library.Flags[Flag] = Default

            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 45)
            })
            Utility:Corner(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Border)

            Utility:Create("TextLabel", {
                Parent = Frame, Text = Name, Font = Library.Theme.Font, TextSize = 14,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 5), Size = UDim2.new(1, -20, 0, 20), TextXAlignment = Enum.TextXAlignment.Left
            })

            local ValueLabel = Utility:Create("TextLabel", {
                Parent = Frame, Text = tostring(Default), Font = Library.Theme.FontBold, TextSize = 14,
                TextColor3 = Library.Theme.Accent, BackgroundTransparency = 1,
                Position = UDim2.new(1, -60, 0, 5), Size = UDim2.new(0, 50, 0, 20), TextXAlignment = Enum.TextXAlignment.Right
            })

            local Bar = Utility:Create("Frame", {
                Parent = Frame, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, -20, 0, 6),
                Position = UDim2.new(0, 10, 0, 30)
            })
            Utility:Corner(Bar, 3)

            local Fill = Utility:Create("Frame", {
                Parent = Bar, BackgroundColor3 = Library.Theme.Accent, Size = UDim2.new(0,0,1,0)
            })
            Utility:Corner(Fill, 3)

            if Tooltip then Utility:Tooltip(Frame, Tooltip) end

            local function Update(val)
                local clamped = math.clamp(val, Min, Max)
                local percent = (clamped - Min) / (Max - Min)
                Library.Flags[Flag] = clamped
                ValueLabel.Text = tostring(clamped)
                Utility:Tween(Fill, {Size = UDim2.fromScale(percent, 1)}, 0.05)
                Callback(clamped)
            end

            local Dragging = false
            Frame.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = true
                    local pos = math.clamp((i.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                    Update(math.floor(Min + ((Max - Min) * pos)))
                end
            end)
            UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then Dragging = false end end)
            UserInputService.InputChanged:Connect(function(i)
                if Dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
                    local pos = math.clamp((i.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                    Update(math.floor(Min + ((Max - Min) * pos)))
                end
            end)
            
            Library.Config[Flag] = Update
            Update(Library.Flags[Flag])
        end

        function Tab:CreateColorPicker(Config)
            local Name = Config.Name or "Color Picker"
            local Flag = Config.Flag or Name
            local Default = Config.Color or Color3.fromRGB(255, 255, 255)
            local Callback = Config.Callback or function() end

            Library.Flags[Flag] = Default
            local H, S, V = Default:ToHSV()
            local Open = false

            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 36),
                ClipsDescendants = true
            })
            Utility:Corner(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Border)

            local ToggleBtn = Utility:Create("TextButton", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 36), Text = ""
            })
            Utility:Create("TextLabel", {
                Parent = ToggleBtn, Text = Name, Font = Library.Theme.Font, TextSize = 14,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(1, -50, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            local Preview = Utility:Create("Frame", {
                Parent = ToggleBtn, BackgroundColor3 = Default, Size = UDim2.fromOffset(24, 24),
                Position = UDim2.new(1, -34, 0.5, -12)
            })
            Utility:Corner(Preview, 4)
            Utility:Stroke(Preview, Library.Theme.Border)

            local PickerArea = Utility:Create("Frame", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 130), Position = UDim2.new(0, 0, 0, 36)
            })
            local SVImg = Utility:Create("ImageLabel", {
                Parent = PickerArea, Image = "rbxassetid://4155801252", Size = UDim2.new(0, 130, 0, 100),
                Position = UDim2.new(0, 10, 0, 10), BackgroundTransparency = 1
            })
            local Cursor = Utility:Create("Frame", {
                Parent = SVImg, BackgroundColor3 = Color3.new(1,1,1), Size = UDim2.fromOffset(6, 6),
                Position = UDim2.fromScale(S, 1-V), AnchorPoint = Vector2.new(0.5,0.5)
            })
            Utility:Corner(Cursor, 3)
            
            local HueBar = Utility:Create("ImageLabel", {
                Parent = PickerArea, Image = "rbxassetid://328298876", Size = UDim2.new(0, 20, 0, 100),
                Position = UDim2.new(0, 150, 0, 10)
            })
            local HueSlide = Utility:Create("Frame", {
                Parent = HueBar, BackgroundColor3 = Color3.new(1,1,1), Size = UDim2.new(1, 2, 0, 2),
                Position = UDim2.fromScale(0, 1-H)
            })

            local function UpdateColor()
                local NewColor = Color3.fromHSV(H, S, V)
                Library.Flags[Flag] = NewColor
                Preview.BackgroundColor3 = NewColor
                SVImg.ImageColor3 = Color3.fromHSV(H, 1, 1)
                Callback(NewColor)
            end

            local function UpdateSV(input)
                local x = math.clamp((input.Position.X - SVImg.AbsolutePosition.X) / SVImg.AbsoluteSize.X, 0, 1)
                local y = math.clamp((input.Position.Y - SVImg.AbsolutePosition.Y) / SVImg.AbsoluteSize.Y, 0, 1)
                S, V = x, 1 - y
                Cursor.Position = UDim2.fromScale(S, 1-V)
                UpdateColor()
            end

            local function UpdateHue(input)
                local y = math.clamp((input.Position.Y - HueBar.AbsolutePosition.Y) / HueBar.AbsoluteSize.Y, 0, 1)
                H = 1 - y
                HueSlide.Position = UDim2.fromScale(0, 1-H)
                UpdateColor()
            end

            local DraggingSV, DraggingHue = false, false
            SVImg.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then DraggingSV=true UpdateSV(i) end end)
            HueBar.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then DraggingHue=true UpdateHue(i) end end)
            UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then DraggingSV=false DraggingHue=false end end)
            UserInputService.InputChanged:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseMovement then
                    if DraggingSV then UpdateSV(i) elseif DraggingHue then UpdateHue(i) end
                end
            end)

            ToggleBtn.MouseButton1Click:Connect(function()
                Open = not Open
                Utility:Tween(Frame, {Size = UDim2.new(1, 0, 0, Open and 170 or 36)})
            end)

            Library.Config[Flag] = function(col)
                H, S, V = col:ToHSV()
                Cursor.Position = UDim2.fromScale(S, 1-V)
                HueSlide.Position = UDim2.fromScale(0, 1-H)
                UpdateColor()
            end
            Library.Config[Flag](Default)
        end

        function Tab:CreateKeybind(Config)
            local Name = Config.Name or "Keybind"
            local Flag = Config.Flag or Name
            local Default = Config.Default or Enum.KeyCode.None
            local Callback = Config.Callback or function() end

            Library.Flags[Flag] = Default
            local Listening = false

            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, 36)
            })
            Utility:Corner(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Border)

            Utility:Create("TextLabel", {
                Parent = Frame, Text = Name, Font = Library.Theme.Font, TextSize = 14,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(1, -100, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })

            local BindBtn = Utility:Create("TextButton", {
                Parent = Frame, BackgroundColor3 = Library.Theme.Main, TextColor3 = Library.Theme.SubText,
                Text = Default.Name, Font = Library.Theme.FontBold, TextSize = 13,
                Size = UDim2.new(0, 80, 0, 24), Position = UDim2.new(1, -90, 0.5, -12)
            })
            Utility:Corner(BindBtn, 4)
            local BindStroke = Utility:Stroke(BindBtn, Library.Theme.Border)

            local function Update(key)
                Library.Flags[Flag] = key
                BindBtn.Text = key.Name
                BindStroke.Color = Library.Theme.Border
                BindBtn.TextColor3 = Library.Theme.SubText
                Listening = false
            end

            BindBtn.MouseButton1Click:Connect(function()
                Listening = true
                BindBtn.Text = "..."
                BindStroke.Color = Library.Theme.Accent
                BindBtn.TextColor3 = Library.Theme.Accent
            end)

            UserInputService.InputBegan:Connect(function(input)
                if Listening and input.UserInputType == Enum.UserInputType.Keyboard then
                    Update(input.KeyCode)
                elseif input.KeyCode == Library.Flags[Flag] and Library.Flags[Flag] ~= Enum.KeyCode.None then
                    Callback()
                end
            end)

            Library.Config[Flag] = Update
            Update(Default)
        end

        function Tab:CreateMultiDropdown(Config)
            local Name = Config.Name or "Multi-Dropdown"
            local Flag = Config.Flag or Name
            local Options = Config.Options or {}
            local Callback = Config.Callback or function() end
            
            Library.Flags[Flag] = {}
            local Open = false
            local Height = 36

            local Frame = Utility:Create("Frame", {
                Parent = Page, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.new(1, 0, 0, Height),
                ClipsDescendants = true
            })
            Utility:Corner(Frame, 4)
            Utility:Stroke(Frame, Library.Theme.Border)

            local Header = Utility:Create("TextButton", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, Height), Text = ""
            })
            local Label = Utility:Create("TextLabel", {
                Parent = Header, Text = Name .. ": None", Font = Library.Theme.Font, TextSize = 14,
                TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(1, -40, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
            })
            local Arrow = Utility:Create("ImageLabel", {
                Parent = Header, Image = "rbxassetid://6031091004", BackgroundTransparency = 1,
                ImageColor3 = Library.Theme.SubText, Size = UDim2.fromOffset(20, 20), Position = UDim2.new(1, -30, 0.5, -10)
            })

            local Container = Utility:Create("ScrollingFrame", {
                Parent = Frame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, -Height), Position = UDim2.new(0, 0, 0, Height),
                ScrollBarThickness = 2, CanvasSize = UDim2.new(0,0,0,0)
            })
            local Layout = Utility:Create("UIListLayout", {Parent = Container, SortOrder = Enum.SortOrder.LayoutOrder})

            local function Refresh()
                local txt = ""
                for opt, selected in pairs(Library.Flags[Flag]) do
                    if selected then txt = txt .. opt .. ", " end
                end
                Label.Text = Name .. ": " .. (txt == "" and "None" or txt:sub(1, -3))
                Callback(Library.Flags[Flag])
            end

            for _, opt in pairs(Options) do
                local OptBtn = Utility:Create("TextButton", {
                    Parent = Container, BackgroundColor3 = Library.Theme.Main, Size = UDim2.new(1, 0, 0, 30),
                    Text = "", AutoButtonColor = false
                })
                local OptCheck = Utility:Create("Frame", {
                    Parent = OptBtn, BackgroundColor3 = Library.Theme.Secondary, Size = UDim2.fromOffset(16, 16),
                    Position = UDim2.new(0, 10, 0.5, -8)
                })
                Utility:Corner(OptCheck, 4)
                local OptStroke = Utility:Stroke(OptCheck, Library.Theme.Border)
                
                Utility:Create("TextLabel", {
                    Parent = OptBtn, Text = opt, Font = Library.Theme.Font, TextSize = 13,
                    TextColor3 = Library.Theme.Text, BackgroundTransparency = 1,
                    Position = UDim2.new(0, 35, 0, 0), Size = UDim2.new(1, -35, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
                })

                OptBtn.MouseButton1Click:Connect(function()
                    Library.Flags[Flag][opt] = not Library.Flags[Flag][opt]
                    if Library.Flags[Flag][opt] then
                        Utility:Tween(OptCheck, {BackgroundColor3 = Library.Theme.Accent})
                        Utility:Tween(OptStroke, {Color = Library.Theme.Accent})
                    else
                        Utility:Tween(OptCheck, {BackgroundColor3 = Library.Theme.Secondary})
                        Utility:Tween(OptStroke, {Color = Library.Theme.Border})
                    end
                    Refresh()
                end)
            end
            Container.CanvasSize = UDim2.new(0,0,0, Layout.AbsoluteContentSize.Y)

            Header.MouseButton1Click:Connect(function()
                Open = not Open
                local contentHeight = math.min(Layout.AbsoluteContentSize.Y + Height, 200)
                Utility:Tween(Frame, {Size = UDim2.new(1, 0, 0, Open and contentHeight or Height)})
                Utility:Tween(Arrow, {Rotation = Open and 180 or 0})
            end)
        end

        return Tab
    end

    return Tabs
end

return Library
