--[[ 
    üêã OrcaUI Library
    Author: OrcaDev (Generated by Assistant)
    Theme: Deep Ocean / Modern
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")

local OrcaUI = {}

-- // Configuration \\ --
local Theme = {
    Main = Color3.fromRGB(20, 20, 30), -- Dark Background
    Secondary = Color3.fromRGB(30, 30, 45), -- Section/Element Background
    Accent = Color3.fromRGB(0, 170, 255), -- Orca Blue
    Text = Color3.fromRGB(240, 240, 240),
    TextDark = Color3.fromRGB(150, 150, 150),
    Stroke = Color3.fromRGB(50, 50, 70)
}

-- // Utility Functions \\ --
local function GetGuiParent()
    return (gethui and gethui()) or CoreGui
end

local function Create(class, props, children)
    local obj = Instance.new(class)
    for k, v in pairs(props or {}) do obj[k] = v end
    for _, child in pairs(children or {}) do child.Parent = obj end
    return obj
end

local function MakeRound(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius)
    corner.Parent = parent
    return corner
end

local function MakeStroke(parent, thickness, color)
    local stroke = Instance.new("UIStroke")
    stroke.Thickness = thickness
    stroke.Color = color or Theme.Stroke
    stroke.Parent = parent
    return stroke
end

local function Tween(obj, props, time)
    TweenService:Create(obj, TweenInfo.new(time or 0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), props):Play()
end

local function Drag(frame, parent)
    parent = parent or frame
    local dragging, dragInput, dragStart, startPos

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = parent.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Tween(parent, {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}, 0.1)
        end
    end)
end

-- // Library Functions \\ --

function OrcaUI:CreateWindow(options)
    local WindowName = options.Name or "Orca Hub"
    local WindowSubtitle = options.Subtitle or "Main"
    
    local ScreenGui = Create("ScreenGui", {Name = "OrcaUI", Parent = GetGuiParent(), ZIndexBehavior = Enum.ZIndexBehavior.Sibling})
    
    local MainFrame = Create("Frame", {
        Name = "MainFrame", Parent = ScreenGui, BackgroundColor3 = Theme.Main,
        Position = UDim2.new(0.5, -300, 0.5, -200), Size = UDim2.new(0, 600, 0, 450), ClipsDescendants = true
    })
    MakeRound(MainFrame, 10)
    MakeStroke(MainFrame, 2, Theme.Accent)
    Drag(MainFrame)

    -- Sidebar
    local Sidebar = Create("Frame", {
        Name = "Sidebar", Parent = MainFrame, BackgroundColor3 = Theme.Secondary,
        Size = UDim2.new(0, 160, 1, 0), ZIndex = 2
    })
    MakeRound(Sidebar, 10)
    
    -- Fix Sidebar Corner (Flat Right side)
    local FixSide = Create("Frame", {Parent = Sidebar, BackgroundColor3 = Theme.Secondary, Size = UDim2.new(0, 10, 1, 0), Position = UDim2.new(1, -10, 0, 0), BorderSizePixel = 0})

    -- Title
    Create("TextLabel", {
        Parent = Sidebar, BackgroundTransparency = 1, Position = UDim2.new(0, 15, 0, 20), Size = UDim2.new(1, -30, 0, 25),
        Font = Enum.Font.GothamBold, Text = WindowName, TextColor3 = Theme.Accent, TextSize = 22, TextXAlignment = Enum.TextXAlignment.Left
    })
    Create("TextLabel", {
        Parent = Sidebar, BackgroundTransparency = 1, Position = UDim2.new(0, 15, 0, 45), Size = UDim2.new(1, -30, 0, 15),
        Font = Enum.Font.Gotham, Text = WindowSubtitle, TextColor3 = Theme.TextDark, TextSize = 12, TextXAlignment = Enum.TextXAlignment.Left
    })

    -- Tab Container
    local TabContainer = Create("ScrollingFrame", {
        Name = "TabContainer", Parent = Sidebar, BackgroundTransparency = 1, Position = UDim2.new(0, 0, 0, 80),
        Size = UDim2.new(1, 0, 1, -90), ScrollBarThickness = 0, CanvasSize = UDim2.new(0, 0, 0, 0)
    })
    local TabListLayout = Create("UIListLayout", {Parent = TabContainer, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)})
    Create("UIPadding", {Parent = TabContainer, PaddingLeft = UDim.new(0, 10), PaddingTop = UDim.new(0, 10)})

    -- Page Container
    local PageContainer = Create("Frame", {
        Name = "PageContainer", Parent = MainFrame, BackgroundTransparency = 1,
        Position = UDim2.new(0, 170, 0, 10), Size = UDim2.new(1, -180, 1, -20)
    })
    local PageFolder = Create("Folder", {Parent = PageContainer})

    local Window = {CurrentTab = nil}

    function Window:CreateTab(options)
        local TabName = options.Name or "Tab"
        local TabIcon = options.Icon or "" -- Todo: Add Icon Support
        
        local TabButton = Create("TextButton", {
            Parent = TabContainer, BackgroundColor3 = Theme.Main, Size = UDim2.new(1, -20, 0, 35),
            Font = Enum.Font.GothamMedium, Text = TabName, TextColor3 = Theme.TextDark, TextSize = 14, AutoButtonColor = false
        })
        MakeRound(TabButton, 6)
        
        local TabPage = Create("ScrollingFrame", {
            Name = TabName, Parent = PageFolder, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 1, 0),
            ScrollBarThickness = 2, ScrollBarImageColor3 = Theme.Accent, Visible = false, CanvasSize = UDim2.new(0,0,0,0)
        })
        local PageLayout = Create("UIListLayout", {Parent = TabPage, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 8)})
        Create("UIPadding", {Parent = TabPage, PaddingRight = UDim.new(0, 5), PaddingBottom = UDim.new(0,10)})

        -- Auto Canvas Resize
        PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            TabPage.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 20)
        end)

        -- Activation Logic
        TabButton.MouseButton1Click:Connect(function()
            -- Reset all tabs
            for _, btn in pairs(TabContainer:GetChildren()) do
                if btn:IsA("TextButton") then
                    Tween(btn, {BackgroundColor3 = Theme.Main, TextColor3 = Theme.TextDark})
                end
            end
            for _, page in pairs(PageFolder:GetChildren()) do
                page.Visible = false
            end

            -- Active this tab
            Tween(TabButton, {BackgroundColor3 = Theme.Accent, TextColor3 = Color3.new(1,1,1)})
            TabPage.Visible = true
        end)

        -- Select first tab automatically
        if Window.CurrentTab == nil then
            Window.CurrentTab = TabButton
            Tween(TabButton, {BackgroundColor3 = Theme.Accent, TextColor3 = Color3.new(1,1,1)})
            TabPage.Visible = true
        end

        local TabFunctions = {}

        -- // SECTIONS \\ --
        function TabFunctions:CreateSection(options)
            local SectionName = options.Name or "Section"
            
            local SectionLabel = Create("TextLabel", {
                Parent = TabPage, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 25),
                Font = Enum.Font.GothamBold, Text = SectionName, TextColor3 = Theme.Accent, TextSize = 12, TextXAlignment = Enum.TextXAlignment.Left
            })
            Create("UIPadding", {Parent = SectionLabel, PaddingLeft = UDim.new(0, 5)})
        end

        -- // BUTTON \\ --
        function TabFunctions:CreateButton(options)
            local Title = options.Name or "Button"
            local Callback = options.Callback or function() end
            
            local ButtonFrame = Create("TextButton", {
                Parent = TabPage, BackgroundColor3 = Theme.Secondary, Size = UDim2.new(1, 0, 0, 40),
                Text = "", AutoButtonColor = false
            })
            MakeRound(ButtonFrame, 6)
            MakeStroke(ButtonFrame, 1, Theme.Stroke)

            local Label = Create("TextLabel", {
                Parent = ButtonFrame, BackgroundTransparency = 1, Size = UDim2.new(1, -40, 1, 0), Position = UDim2.new(0, 10, 0, 0),
                Font = Enum.Font.GothamMedium, Text = Title, TextColor3 = Theme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left
            })

            local Icon = Create("ImageLabel", {
                Parent = ButtonFrame, BackgroundTransparency = 1, Position = UDim2.new(1, -30, 0.5, -10), Size = UDim2.new(0, 20, 0, 20),
                Image = "rbxassetid://10709791437", ImageColor3 = Theme.TextDark -- Click icon
            })

            ButtonFrame.MouseButton1Click:Connect(function()
                Tween(ButtonFrame, {BackgroundColor3 = Theme.Accent}, 0.1)
                Tween(Label, {TextColor3 = Color3.new(1,1,1)}, 0.1)
                task.wait(0.1)
                Tween(ButtonFrame, {BackgroundColor3 = Theme.Secondary}, 0.2)
                Tween(Label, {TextColor3 = Theme.Text}, 0.2)
                Callback()
            end)
        end

        -- // TOGGLE \\ --
        function TabFunctions:CreateToggle(options)
            local Title = options.Name or "Toggle"
            local Default = options.CurrentValue or false
            local Callback = options.Callback or function() end
            
            local ToggleFrame = Create("TextButton", {
                Parent = TabPage, BackgroundColor3 = Theme.Secondary, Size = UDim2.new(1, 0, 0, 40),
                Text = "", AutoButtonColor = false
            })
            MakeRound(ToggleFrame, 6)
            MakeStroke(ToggleFrame, 1, Theme.Stroke)

            Create("TextLabel", {
                Parent = ToggleFrame, BackgroundTransparency = 1, Size = UDim2.new(1, -60, 1, 0), Position = UDim2.new(0, 10, 0, 0),
                Font = Enum.Font.GothamMedium, Text = Title, TextColor3 = Theme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left
            })

            local SwitchBg = Create("Frame", {
                Parent = ToggleFrame, BackgroundColor3 = Theme.Main, Size = UDim2.new(0, 40, 0, 20), Position = UDim2.new(1, -50, 0.5, -10)
            })
            MakeRound(SwitchBg, 10)
            
            local SwitchCircle = Create("Frame", {
                Parent = SwitchBg, BackgroundColor3 = Theme.TextDark, Size = UDim2.new(0, 16, 0, 16), Position = UDim2.new(0, 2, 0.5, -8)
            })
            MakeRound(SwitchCircle, 8)

            local Toggled = Default

            local function UpdateToggle()
                if Toggled then
                    Tween(SwitchBg, {BackgroundColor3 = Theme.Accent})
                    Tween(SwitchCircle, {Position = UDim2.new(1, -18, 0.5, -8), BackgroundColor3 = Color3.new(1,1,1)})
                else
                    Tween(SwitchBg, {BackgroundColor3 = Theme.Main})
                    Tween(SwitchCircle, {Position = UDim2.new(0, 2, 0.5, -8), BackgroundColor3 = Theme.TextDark})
                end
                Callback(Toggled)
            end

            -- Init
            if Toggled then UpdateToggle() end

            ToggleFrame.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                UpdateToggle()
            end)
            
            local Funcs = {}
            function Funcs:Set(val)
                Toggled = val
                UpdateToggle()
            end
            return Funcs
        end

        -- // SLIDER \\ --
        function TabFunctions:CreateSlider(options)
            local Title = options.Name or "Slider"
            local Min = options.Range[1] or 0
            local Max = options.Range[2] or 100
            local Default = options.CurrentValue or Min
            local Callback = options.Callback or function() end

            local SliderFrame = Create("Frame", {
                Parent = TabPage, BackgroundColor3 = Theme.Secondary, Size = UDim2.new(1, 0, 0, 50)
            })
            MakeRound(SliderFrame, 6)
            MakeStroke(SliderFrame, 1, Theme.Stroke)

            Create("TextLabel", {
                Parent = SliderFrame, BackgroundTransparency = 1, Size = UDim2.new(1, -10, 0, 25), Position = UDim2.new(0, 10, 0, 0),
                Font = Enum.Font.GothamMedium, Text = Title, TextColor3 = Theme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left
            })

            local ValueLabel = Create("TextLabel", {
                Parent = SliderFrame, BackgroundTransparency = 1, Size = UDim2.new(0, 50, 0, 25), Position = UDim2.new(1, -60, 0, 0),
                Font = Enum.Font.Gotham, Text = tostring(Default), TextColor3 = Theme.TextDark, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Right
            })

            local SliderBg = Create("Frame", {
                Parent = SliderFrame, BackgroundColor3 = Theme.Main, Size = UDim2.new(1, -20, 0, 6), Position = UDim2.new(0, 10, 0, 32)
            })
            MakeRound(SliderBg, 3)

            local SliderFill = Create("Frame", {
                Parent = SliderBg, BackgroundColor3 = Theme.Accent, Size = UDim2.new(0, 0, 1, 0)
            })
            MakeRound(SliderFill, 3)

            local function Update(Input)
                local SizeX = math.clamp((Input.Position.X - SliderBg.AbsolutePosition.X) / SliderBg.AbsoluteSize.X, 0, 1)
                local Value = math.floor(Min + ((Max - Min) * SizeX))
                
                Tween(SliderFill, {Size = UDim2.new(SizeX, 0, 1, 0)}, 0.05)
                ValueLabel.Text = tostring(Value)
                Callback(Value)
            end

            local Dragging = false
            SliderFrame.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = true
                    Update(input)
                end
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then Dragging = false end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    Update(input)
                end
            end)

            -- Set Default
            local DefaultScale = (Default - Min) / (Max - Min)
            SliderFill.Size = UDim2.new(DefaultScale, 0, 1, 0)
        end

        -- // DROPDOWN \\ --
        function TabFunctions:CreateDropdown(options)
            local Title = options.Name or "Dropdown"
            local Options = options.Options or {}
            local Current = options.CurrentOption or Options[1] or ""
            local Callback = options.Callback or function() end

            local DropdownFrame = Create("Frame", {
                Parent = TabPage, BackgroundColor3 = Theme.Secondary, Size = UDim2.new(1, 0, 0, 40),
                ClipsDescendants = true
            })
            MakeRound(DropdownFrame, 6)
            MakeStroke(DropdownFrame, 1, Theme.Stroke)

            local DropButton = Create("TextButton", {
                Parent = DropdownFrame, BackgroundTransparency = 1, Size = UDim2.new(1, 0, 0, 40),
                Text = "", AutoButtonColor = false
            })

            Create("TextLabel", {
                Parent = DropButton, BackgroundTransparency = 1, Position = UDim2.new(0, 10, 0, 0), Size = UDim2.new(1, -40, 1, 0),
                Font = Enum.Font.GothamMedium, Text = Title .. ": " .. tostring(Current), TextColor3 = Theme.Text, TextSize = 14, TextXAlignment = Enum.TextXAlignment.Left, Name = "ValLabel"
            })

            local Arrow = Create("ImageLabel", {
                Parent = DropButton, BackgroundTransparency = 1, Position = UDim2.new(1, -30, 0.5, -10), Size = UDim2.new(0, 20, 0, 20),
                Image = "rbxassetid://6031091004", ImageColor3 = Theme.TextDark
            })

            local OptionList = Create("ScrollingFrame", {
                Parent = DropdownFrame, BackgroundTransparency = 1, Position = UDim2.new(0, 0, 0, 40), Size = UDim2.new(1, 0, 1, -45),
                ScrollBarThickness = 2, CanvasSize = UDim2.new(0,0,0,0)
            })
            local ListLayout = Create("UIListLayout", {Parent = OptionList, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 2)})
            
            -- Logic
            local Open = false
            local function RefreshOptions()
                for _, v in pairs(OptionList:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
                
                for _, opt in pairs(Options) do
                    local OptBtn = Create("TextButton", {
                        Parent = OptionList, BackgroundColor3 = Theme.Main, Size = UDim2.new(1, -10, 0, 30),
                        Font = Enum.Font.Gotham, Text = opt, TextColor3 = Theme.TextDark, TextSize = 13, AutoButtonColor = false,
                        Position = UDim2.new(0,5,0,0)
                    })
                    MakeRound(OptBtn, 4)
                    
                    OptBtn.MouseButton1Click:Connect(function()
                        Current = opt
                        DropButton.ValLabel.Text = Title .. ": " .. tostring(Current)
                        Callback(opt)
                        Open = false
                        Tween(DropdownFrame, {Size = UDim2.new(1, 0, 0, 40)}, 0.2)
                        Tween(Arrow, {Rotation = 0}, 0.2)
                    end)
                end
                OptionList.CanvasSize = UDim2.new(0, 0, 0, ListLayout.AbsoluteContentSize.Y)
            end

            DropButton.MouseButton1Click:Connect(function()
                Open = not Open
                if Open then
                    RefreshOptions()
                    local ListSize = math.min(#Options * 32, 150)
                    Tween(DropdownFrame, {Size = UDim2.new(1, 0, 0, 40 + ListSize)}, 0.2)
                    Tween(Arrow, {Rotation = 180}, 0.2)
                else
                    Tween(DropdownFrame, {Size = UDim2.new(1, 0, 0, 40)}, 0.2)
                    Tween(Arrow, {Rotation = 0}, 0.2)
                end
            end)
        end

        return TabFunctions
    end

    function Window:Destroy()
        ScreenGui:Destroy()
    end

    return Window
end

return OrcaUI
